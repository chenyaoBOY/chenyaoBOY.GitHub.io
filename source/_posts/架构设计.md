---
title: 架构设计
keywords: 系统设计 架构设计
date:

categories: 架构
tags:
- 系统设计

---

### 架构分类

- 业务架构——业务要做的事情的集合
- 产品架构——功能模块的归并分类
- 数据架构——如何存储数据、使用数据，系统需要什么数据
- 应用架构——应用之间的关联、耦合、复用、集成
- 技术架构——技术分层、技术框架选择、开发语言、使用的中间件、技术选型




### 1.概念
#### 1.1系统与子系统

#### 1.2模块与组件
模块强调职责分离，是逻辑上的系统拆分
组件注重单元复用，是物理上的系统拆分

#### 1.3框架与架构
框架关注规范
架构关注结构

### 四色原型法进行业务模型的抽象
- 事物在某个时刻或某一段时间内发生的。使用红色表示，在 定义过程中，一种方法是通过名词+动词进行定义
- 参与扮演不同角色的人或事物，使用绿色表示
- 角色是一种参与方式，它由人或组织机构、地点或物品来承担。使用黄色表示
- 资料类型的资源，它可以被其它原型反复使用，并为其它原型提供行为。使用蓝色表示


![](images/jiagousheji/img.png)

![](images/jiagousheji/img_1.png)

![](images/jiagousheji/img_2.png)


### 3产品架构
#### 水平划分
按照同一产品范围的模块放在同一层级的原则
#### 垂直划分
当应用内存在几个相对独立的模块，每个模块的业务逻辑差别比较大，且内部的组成较为复杂和庞大时，还需要进一步对应用内进行子系统的切分。这里的切分原则是，对应用内按业务进行切分，保证子应用是相互独立。

### 4应用架构
#### 4.1 单体式应用
单体式应用架构是比较传统的分为 4 层：数据层（Data Layer）、应用逻辑层（Business Layer）、表现层（Presentation Layer）和基础通用层（Common Layer）

![](images/jiagousheji/img_3.png)


 **通用基础层**
通用基础层是为系统提供通用能力的中间件，比如流程引擎、消息中间件、缓存、搜索引擎等等。这些中间件和业务是无相关性的，提供的是通用的基础技术能力


#### 4.2分布式应用

单体式应用在分布式环境下的应用


{% label 最终一种好的应用架构图，应该具备以下特点 %}

- 清晰的应用边界。
- 应用之间的调用关系明确。
- 有入必有出，有输入系统、必有输出系统。
- 清晰的呈现应用的全局关系。



### 技术架构

https://www.infoq.cn/article/RQDwWxDcwbxtwU8LBFSG

#### 5.1战略设计
- 合适原则——不要一味追求新技术、合适的才是最好的
- 简单原则——大道至简
  - 结构复杂性——指组件之间的耦合关系
    - 第一，组成的组件数量很多；
    - 第二，这些组件之间的关系很复杂
  - 逻辑复杂性——只单个组件内部的复杂性
- 演化原则
> 如果没有意识到“软件架构需要根据业务发展不断变化”这个本质，在做架构设计的时候很容易陷入一个误区：试图一步到位设计一个软件架构，期望不管业务如何变化，架构都稳如磐石。如果是按照这样的目标是设计，一开始上来就做出一套看似是终极的方案，投入庞大的资源做各种预测、分析。结果是投入巨大的资源、开发周期漫长，最终跌跌撞撞落地的系统，却发现已经无法很好的满足现有的业务。


#### 5.2战术设计
**5.2.1 高并发原则**
设计高并发的系统，需要考虑以下几个方面的设计：**无状态、拆分、服务化、消息队列、数据异构、缓存**
- 无状态应用，便于水平扩展

{% label 拆分 %}
- 系统维度——按照功能拆分，比如订单、购物车、支付
- 功能维度——单系统再拆分，订单中的签收、发货、取消等
- 读写维度——读多考虑多级缓存、写多考虑分库分表
- AOP维度——按照AOP拆分
- 模块维度——web service dao

{% label 服务化 %}
- 服务的发现、注册、超时、熔断、黑白名单、路由、限流、隔离、分组
- 服务治理

{% label 消息队列 %}
- 异步、消峰、解耦
- 缓冲，保证最终一致性

{% label 数据异构（不太理解） %}
- 数据异构：通过消息队列机制接受数据变更，原子化存储。
- 数据闭环：屏蔽多重数据来源，将数据异构存储，形成闭环。

{% label 缓存 %}
- 用户层：各种DNS缓存、C端缓存
- DNS 缓存、浏览器 DNS 缓存、操作系统 DNS 缓存、本地 DNS 服务商缓存、DNS 服务器缓存、客户端缓存、浏览器缓存、APP 客户端缓存。
- 代理层：CDN 缓存
  - 一般基于 ATS、Varnish、Nginx、Squid 等构建，边缘节点 -二级节点 -中心节点 -源
- 接入层：Nginx 的 Proxy_cache 代理缓存，或者 Nginx+Lua+Redis 做业务数据缓存。
- 应用层：页面静态化、业务数据缓存（Redis/Memcache/本地文件等）、消息队列
- 数据层：NoSQL（Redis、Memcache、SSDB 等）

#### 5.2.2 高可用原则、容灾原则
{% label 降级 %}
降级开关集中化管理：将开关配置信息推送到各个应用。
可降级的多级读服务：如服务调用降级为只读本地缓存。
开关前置化：如 Nginx+Lua 配置降级策略，引流流量；可基于此做灰度策略。
业务降级：高并发下，保证核心功能，次要功能可由同步改为异步策略或屏蔽功能。


{% label 限流 %}
目的：防止恶意请求攻击或超过系统峰值
恶意请求流量只访问到 Cache
穿透后端应用的流量 Nginx 的 limit 处理
恶意 Ip 使用 Nginx Deny 策略或者 iptables 拒绝


{% label 回滚 %}
发布版本失败时，可随时快速回退到上一个稳定版本。


{% label 备份 %}
备份容灾
多机房部署

##### 5.2.3 业务设计原则
防重
幂等
状态机
后台系统审批
后台系统权限控制
后台系统操作可反馈

#### 5.3技术架构图
5.3.1逻辑架构图
是描绘如何通过技术组件来实现系统产品功能的图
可分为局部 和整体



![](images/jiagousheji/img_4.png)


物理架构图
是描绘如何通过物理部署的来实现系统运行的图

物理架构偏重于网络设计、集群设计、中间件设计、数据存储设计等基础软硬件的设计架构


![](images/jiagousheji/img_5.png)
